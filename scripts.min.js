const FORM_SUBMISSION_TIMEOUT=3e4;document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("hero-canvas");e&&function(e){const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=window.matchMedia("(min-width: 768px)").matches,o=window.matchMedia("(hover: hover) and (pointer: fine)").matches;if(t||!n)return;const r=e.getContext("2d");if(!r)return;const a=window.matchMedia("(prefers-color-scheme: dark)").matches,i=[{r:255,g:182,b:193,a:.6},{r:173,g:216,b:230,a:.6},{r:221,g:160,b:221,a:.6},{r:255,g:239,b:213,a:.5}],c=[{r:99,g:102,b:241,a:.7},{r:139,g:92,b:246,a:.7},{r:34,g:211,b:238,a:.6},{r:236,g:72,b:153,a:.6}],s=a?c:i;function l(){const t=e.parentElement.getBoundingClientRect();e.width=t.width,e.height=t.height}let d;function u(){d&&cancelAnimationFrame(d),d=requestAnimationFrame(l)}l(),window.addEventListener("resize",u);const m=s.map((t,n)=>({x:Math.random()*e.width,y:Math.random()*e.height,vx:.3*(Math.random()-.5),vy:.3*(Math.random()-.5),radius:150+200*Math.random(),color:t,phase:Math.random()*Math.PI*2}));let h,p=e.width/2,g=e.height/2,y=p,f=g,v=!1;o&&(e.parentElement.addEventListener("mousemove",t=>{const n=e.getBoundingClientRect();y=t.clientX-n.left,f=t.clientY-n.top,v=!0}),e.parentElement.addEventListener("mouseleave",()=>{v=!1}));let b=0;function w(){if(b+=.005,r.clearRect(0,0,e.width,e.height),p+=.1*(y-p),g+=.1*(f-g),m.forEach(t=>{t.x+=t.vx+.5*Math.sin(b+t.phase),t.y+=t.vy+.5*Math.cos(b+.7*t.phase),(t.x<-t.radius||t.x>e.width+t.radius)&&(t.vx*=-1),(t.y<-t.radius||t.y>e.height+t.radius)&&(t.vy*=-1);const n=r.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);n.addColorStop(0,`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, ${t.color.a})`),n.addColorStop(.5,`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, ${.5*t.color.a})`),n.addColorStop(1,"rgba(0, 0, 0, 0)"),r.fillStyle=n,r.beginPath(),r.arc(t.x,t.y,t.radius,0,2*Math.PI),r.fill()}),v&&o){const e=300,t=r.createRadialGradient(p,g,0,p,g,e),n=a?"rgba(255, 255, 255, 0.12)":"rgba(99, 102, 241, 0.15)";t.addColorStop(0,n),t.addColorStop(1,"rgba(0, 0, 0, 0)"),r.globalCompositeOperation="screen",r.fillStyle=t,r.beginPath(),r.arc(p,g,e,0,2*Math.PI),r.fill(),r.globalCompositeOperation="source-over"}h=requestAnimationFrame(w)}let E=!1;function S(){E||(E=!0,w())}function x(){h&&(cancelAnimationFrame(h),h=null),E=!1}function L(){x(),window.removeEventListener("resize",u)}S(),document.addEventListener("visibilitychange",()=>{document.hidden?x():S()}),window.addEventListener("beforeunload",L)}(e);const t=document.querySelector(".menu-toggle"),n=document.querySelector(".nav-menu");t&&t.addEventListener("click",function(){n.classList.toggle("active");const e="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",!e)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const o=document.querySelector(this.getAttribute("href"));o&&(o.scrollIntoView({behavior:"smooth",block:"start"}),n&&n.classList.contains("active")&&(n.classList.remove("active"),t.setAttribute("aria-expanded","false")))})}),document.querySelectorAll(".btn[data-package]").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-package"),n=document.querySelector(`input[name="package"][value="${t}"]`);n&&(n.checked=!0,c());const o=document.querySelector("#enquiry");o&&o.scrollIntoView({behavior:"smooth"})})});const o=document.getElementById("setup-cost"),r=document.getElementById("monthly-cost"),a=document.getElementById("first-year-cost"),i=document.getElementById("price-estimator");function c(){let e=0,t=0;const n=document.querySelector('input[name="package"]:checked');if(n){if("not-sure"===n.value)return void(i&&(i.style.display="none"));e+=parseInt(n.getAttribute("data-setup"))||0,t+=parseInt(n.getAttribute("data-monthly"))||0}document.querySelectorAll('input[type="checkbox"][name^="addon-"]:checked').forEach(n=>{e+=parseInt(n.getAttribute("data-setup"))||0,t+=parseInt(n.getAttribute("data-monthly"))||0});const c=e+12*t;o&&(o.textContent="$"+e.toLocaleString()),r&&(r.textContent="$"+t.toLocaleString()+"/mo"),a&&(a.textContent="$"+c.toLocaleString()),n&&i&&(i.style.display="block")}document.querySelectorAll('input[name="package"]').forEach(e=>{e.addEventListener("change",c)}),document.querySelectorAll('input[type="checkbox"][name^="addon-"]').forEach(e=>{e.addEventListener("change",c)});const s=document.getElementById("enquiry-form");if(s&&s.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("submit-btn"),n=document.getElementById("form-message"),i=t.querySelector(".btn-text"),l=t.querySelector(".btn-loader"),d=document.getElementById("privacy-agree");if(!d.checked)return void(n&&(n.textContent="Please accept the Privacy Policy to proceed.",n.className="form-message error",n.style.display="block"));t.disabled=!0,i.style.display="none",l.style.display="inline";const u=new FormData(s),m=document.querySelector('input[name="package"]:checked');let h={};m&&(h={package_name:m.value,setup_cost:parseInt(m.getAttribute("data-setup"))||0,monthly_cost:parseInt(m.getAttribute("data-monthly"))||0});const p=[],g=[];document.querySelectorAll('input[type="checkbox"][name^="addon-"]:checked').forEach(e=>{p.push(e.value),g.push({name:e.value,setup:parseInt(e.getAttribute("data-setup"))||0,monthly:parseInt(e.getAttribute("data-monthly"))||0})});const y={name:u.get("name"),email:u.get("email"),phone:u.get("phone"),package:h,addons:g,addons_list:p.join(", "),total_setup:o?o.textContent:"$0",total_monthly:r?r.textContent:"$0/mo",first_year_total:a?a.textContent:"$0",message:u.get("message"),privacy_agreed:d.checked,submitted_at:(new Date).toISOString(),user_agent:navigator.userAgent};try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e4),o=await fetch(s.action,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(y),signal:e.signal});if(clearTimeout(t),!o.ok)throw new Error(`Server responded with status ${o.status}`);const r=await o.json();if(!r.ok){let e="Submission failed";throw r.error?e=r.error:r.errors&&Array.isArray(r.errors)&&(e=r.errors.map(e=>e.message).join(", ")),new Error(e)}n&&(n.textContent="Thank you! We've received your enquiry and will be in touch within 24 hours.",n.className="form-message success",n.style.display="block"),s.reset(),c(),n.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(e){if(console.error("Form submission error:",e),n){let t="Sorry, there was an error submitting your enquiry. ";"AbortError"===e.name?t+="The request timed out. Please check your connection and try again, or ":e.message.includes("status")?t+="The server encountered an issue. Please try again later, or ":t+="Please try again, or ",t+="email us directly at hello@hevin.design",n.textContent=t,n.className="form-message error",n.style.display="block"}}finally{t.disabled=!1,i.style.display="inline",l.style.display="none"}}),c(),window.matchMedia("(max-width: 767px)").matches){document.querySelectorAll(".pricing-card").forEach(e=>{const t=e.querySelector(".pricing-toggle");t&&t.addEventListener("click",function(){const n=e.classList.contains("expanded");e.classList.toggle("expanded"),t.setAttribute("aria-expanded",!n)})})}const l=document.querySelector(".portfolio-carousel");if(l){const f=document.querySelector(".portfolio-carousel-wrapper .carousel-nav-prev"),v=document.querySelector(".portfolio-carousel-wrapper .carousel-nav-next");if(f&&v){const b=400;function d(){const e=l.scrollLeft,t=l.scrollWidth-l.clientWidth;f.disabled=e<=0,v.disabled=e>=t-1}function u(e){const t=l.scrollLeft,n=e-t,o=b,r=performance.now();requestAnimationFrame(function e(a){const i=a-r,c=Math.min(i/o,1),s=(d=c,1-Math.pow(1-d,3));var d;l.scrollLeft=t+n*s,c<1&&requestAnimationFrame(e)})}f.addEventListener("click",()=>{const e=l.querySelector(".portfolio-card").offsetWidth,t=parseInt(getComputedStyle(l).gap),n=l.scrollLeft-(e+t);u(Math.max(0,n))}),v.addEventListener("click",()=>{const e=l.querySelector(".portfolio-card").offsetWidth,t=parseInt(getComputedStyle(l).gap),n=l.scrollWidth-l.clientWidth,o=l.scrollLeft+(e+t);u(Math.min(n,o))}),l.addEventListener("scroll",d),window.addEventListener("resize",d),d()}if(window.matchMedia("(hover: hover) and (pointer: fine)").matches){const w=.5;let E;l.addEventListener("wheel",e=>{if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)||e.shiftKey))return;e.preventDefault(),E&&clearTimeout(E);const t=(e.deltaX||e.deltaY)*w,n=l.scrollWidth-l.clientWidth,o=Math.max(0,Math.min(n,l.scrollLeft+t));l.scrollTo({left:o,behavior:"smooth"}),E=setTimeout(()=>{E=null},50)},{passive:!1})}}const m=document.querySelector(".services-grid");if(m&&window.matchMedia("(max-width: 767px)").matches){if(!window.matchMedia("(prefers-reduced-motion: reduce)").matches){let S,x,L=!1;const k=3e3,I=5e3;function h(){if(L)return;const e=m.querySelector(".service-card").offsetWidth,t=parseInt(getComputedStyle(m).gap),n=m.scrollWidth-m.clientWidth;let o=m.scrollLeft+e+t;o>=n&&(o=0),m.scrollTo({left:o,behavior:"smooth"})}function p(){S=setInterval(h,k)}function g(){S&&(clearInterval(S),S=null)}function y(){L=!0,g(),x&&clearTimeout(x),x=setTimeout(()=>{L=!1,p()},I)}m.addEventListener("touchstart",y),m.addEventListener("scroll",y),p(),document.addEventListener("visibilitychange",()=>{document.hidden?g():L||p()})}}if(window.matchMedia("(hover: none)").matches){const q=document.querySelectorAll(".pricing-card");if(q.length>0&&"IntersectionObserver"in window){if(!window.matchMedia("(prefers-reduced-motion: reduce)").matches){const A=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?e.target.classList.add("in-view"):e.target.classList.remove("in-view")})},{root:null,rootMargin:"-20% 0px -20% 0px",threshold:.5});q.forEach(e=>{A.observe(e)})}}}});